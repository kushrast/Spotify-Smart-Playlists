<div class="container">
	{{#playlists}}
		<div class="playlist-body" id="playlist-bod">
			<div class="card">
				<div class="card-body">
					<h5 class="card-title">{{name}}</h5>
					<button type="button" class="btn btn-outline-primary" id="play-curr">Play</button>
					<div class="row">
						<div class="play-handle col-md-1">
							<i class="fas fa-arrows-alt"></i>
						</div>
						<div class="col-md-11">
							<ol class="list-group song-list" id="{{uri}}">
								{{#tracks.items}}
								  <li class="dl-horizontal list-group-item" id="{{track.uri}}">
								  	<div class="row">
									  	<div class="col-md-1">
									  		<i class="fas fa-music song-handle"></i>
									  	</div>
									  	<div class="col-md-3">
									      <dt class="playlist_uri">Added At</dt><dd>{{added_at}}</a></dd>
									    </div>
									    <div class="col-md-3">
									    	<dt class="playlist_uri">Name</dt><dd>{{track.name}}</a></dd>
									    </div>
								    </div>
								  </li>
								{{/tracks.items}}
							</ol>
						</div>
					</div>
				</div>
			</div>
		</div>
	{{/playlists}}
</div>

<script>
$(".song-list").each(function() {
	Sortable.create(this,
	{
		group: "songs",
		onSort: function(evt) {
			var old = evt.from;
			var curr = evt.to;
			var old_p = evt.oldIndex;
			var curr_p = evt.newIndex;

			var item = $(curr).eq(curr_p);
			console.log(item);

			if (old == curr) {
				$.ajax({
					url: "/playlists/" + $(curr).attr('id') + "/reorder",
					type: "post",
					data: JSON.stringify({
						"song_id": item.attr('id'),
						"old_position": old_p,
						"new_position": curr_p
					})
				});
			} else {
				$.ajax({
					url: "/playlists/" + $(old).attr('id') + "/remove",
					type: "post",
					data: JSON.stringify({
						"song_id": item.attr('id'),
						"position": old_p,
					})
				});

				$.ajax({
					url: "/playlists/" + $(curr).attr('id') + "/add",
					type: "post",
					data: JSON.stringify({
						"song_id": item.attr('id'),
						"position": curr_p
					})
				});
			}

			// $.ajax({
			// 	url: "/playlists/" + $(evt.to).attr('id') + "/update",
			// 	type: "post",
			// 	data: JSON.stringify({
			// 		"uris": to_uris
			// 	})
			// });
			// from_uris = [];
			// $(evt.from).find("li").each(function(){
			// 	from_uris.push($(this).attr('id'));
			// });

			// $.ajax({
			// 	url: "/playlists/" + $(evt.from).attr('id') + "/update",
			// 	type: "post",
			// 	data: JSON.stringify({
			// 		"uris": from_uris
			// 	})
			// });
		}
	})
});

function playSongs(event) {
	item = event.target
	var track_uris = []
	var curr_tracks = item.parentElement.getElementsByClassName("song-list");
	$(curr_tracks).children().each(function() {
	    console.log($(this).attr('id'));
	    track_uris.push($(this).attr('id'));
	});
  	$.ajax({
        url: '/playlists/play',
        type: 'post',
        data: JSON.stringify({
        	'uris': track_uris
        })
    });
}

$(document).on('click', '#play-curr', playSongs);


</script>